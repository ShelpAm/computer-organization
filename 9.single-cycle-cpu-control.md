# Single-cycle CPU control

This documentation describes how to design the control unit inside CPU.

## Control and Status Registers (CSRs)

Control and status registers (CSRs) are:

*   Separate from the register file (x0-x31).
*   Used for monitoring the status and performance.
*   Necessary for counters, timers, and communication with peripherals.

There can be up to 4096 CSRs.

They are not in the base ISA, but almost mandatory in every implementation: they
used to be in the base ISA, but they've been taken out for modularity reasons.

### CSR instruction

CSR instruction format is as below.

|Type|Fields| | | | |
|---|---|---|---|---|---|
|Interval|`[31:20]`|`[19:15]`|`[14:12]`|`[11:7]`|`[6:0]`|
|Field name|csr|rs1|funct3|rd|opcode|
|Width (in bits)|12|5|3|5|7|
|Description|source/dest|source or uimmediate\[4:0]|instr.|rd|SYSTEM (1110011)|

Some of the CSR instruction examples:

*   Instructions whose operand is registers:

    |Instruction|rd|rs|Read CSR?|Write CSR?|
    |---|---|---|---|---|
    |csrrw (read write)|x0|-|no|yes|
    |csrrw|!x0|-|yes|yes|
    |csrrs/c (read set/clear)|-|x0|yes|no|
    |csrrs/c|-|!x0|yes|yes|

*   Immediate-operand variant to the instructions above:

    |Instruction|rd|uimm|Read CSR?|Write CSR?|
    |---|---|---|---|---|
    |csrrw (read write)|x0|-|no|yes|
    |csrrw|!x0|-|yes|yes|
    |csrrs/c (read set/clear)|-|0|yes|no|
    |csrrs/c|-|!0|yes|yes|


